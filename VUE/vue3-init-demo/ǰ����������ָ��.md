# 前端内网配置指南

本文档提供配置前端应用程序连接到内网服务器的详细步骤。

## 一、基本配置

内网部署时，前端需要正确配置API后端地址。主要配置文件是`vite.config.ts`。

### 修改API服务器地址

1. 打开`vite.config.ts`文件
2. 找到`proxy`部分，修改所有`target`为您的内网API服务器地址：

```typescript
proxy: {
  // 所有API请求都通过统一前缀
  '/api': {
    // 将此地址修改为您的内网API服务器地址
    target: 'http://192.168.1.100:8080',
    changeOrigin: true,
    secure: false
  },
  // 文件相关接口
  '/file': {
    target: 'http://192.168.1.100:8080/api',
    changeOrigin: true,
    rewrite: (path) => path.replace(/^\/file/, '')
  },
  // 以下接口地址也需要同步修改
  '/chat': {
    target: 'http://192.168.1.100:8080/api',
    changeOrigin: true,
    rewrite: (path) => path.replace(/^\/chat/, '')
  },
  '/stream-chat': {
    target: 'http://192.168.1.100:8080/api',
    changeOrigin: true,
    rewrite: (path) => path.replace(/^\/stream-chat/, '')
  },
  // ...其他接口
}
```

将上述配置中的`192.168.1.100:8080`替换为您实际的API服务器IP和端口。

## 二、构建和部署前端

### 开发环境运行

```bash
# 安装依赖
npm install

# 启动开发服务器
npm run dev
```

开发服务器会在浏览器中打开前端应用（默认地址 http://localhost:3000）。

### 生产环境部署

1. 构建生产版本：

```bash
npm run build
```

2. 生成的文件会保存在`dist`目录中。您可以使用任何Web服务器（如Nginx、Apache）部署这些静态文件。

### 使用Nginx部署前端示例

1. 安装Nginx（以Ubuntu为例）：

```bash
sudo apt install nginx
```

2. 创建Nginx配置文件（例如 `/etc/nginx/sites-available/we-chatbot`）：

```nginx
server {
    listen 80;
    server_name your_domain.com;  # 或使用服务器IP

    root /path/to/vue3-init-demo/dist;
    index index.html;

    location / {
        try_files $uri $uri/ /index.html;
    }

    # 后端API代理
    location /api/ {
        proxy_pass http://192.168.1.100:8080/api/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # 其他API代理
    location /file/ {
        proxy_pass http://192.168.1.100:8080/api/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    location /chat/ {
        proxy_pass http://192.168.1.100:8080/api/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    # 流式API需要特殊处理
    location /api/stream-chat {
        proxy_pass http://192.168.1.100:8080/api/stream-chat;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header Connection '';
        proxy_http_version 1.1;
        chunked_transfer_encoding off;
        proxy_buffering off;
        proxy_cache off;
        proxy_read_timeout 300s;
    }
}
```

3. 启用配置并重启Nginx：

```bash
sudo ln -s /etc/nginx/sites-available/we-chatbot /etc/nginx/sites-enabled/
sudo nginx -t  # 测试配置有效性
sudo systemctl restart nginx
```

## 三、特殊情况处理

### 1. 直接访问API服务器

如果您的内网服务器可以直接从浏览器访问，并且已经处理了CORS（跨域资源共享）问题，您可以直接在`.env`文件中设置API地址：

```
VITE_BASE_URL=http://192.168.1.100:8080
```

然后修改相关API调用代码，使用此基础URL。

### 2. 处理HTTPS

如果您的服务部署在HTTPS下，确保：

1. 在Nginx配置中正确设置SSL证书
2. 将所有API代理的URL从http改为https
3. 考虑添加HTTPS重定向

### 3. 处理WebSocket和流式聊天

流式聊天功能使用EventSource（SSE），确保：

1. 正确配置代理以支持长连接
2. 设置足够长的超时时间
3. 禁用代理缓存和缓冲

## 四、测试连接

部署完成后，可通过以下步骤验证连接：

1. 打开浏览器，访问您的前端应用
2. 尝试登录系统（如需）
3. 执行API健康检查：应用启动时会自动调用`/api/health-check`
4. 尝试上传一个公文文档并进行纠错，测试完整流程

如果遇到连接问题，检查浏览器开发者工具中的网络请求和控制台错误信息，确认API请求的URL是否正确。 